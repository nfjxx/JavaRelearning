## JVM

### 内存结构

![JVM模型](https://gitee.com/picgo-table/picgo-img/raw/master/image/image-20210326113529412.png)

#### 虚拟机栈(Java方法运行过程的内存模型)：

每个方法执行的同时都会创建一个栈帧（Stack Frame）用于存储局部变量表、操作数栈、动态链接、方法出口等信息。

每个方法从调用直至完成的过程，都对应着一个栈帧从入栈到出栈的过程。随着线程创建而创建，随着线程的结束而销毁。

每当一个方法执行完成时，该栈帧就会弹出栈帧的元素作为这个方法的返回值，并且清除这个栈帧。

Java栈的栈顶的栈帧对应当前正在执行的活动栈，也就是当前正在执行的方法。方法的调用过程也是由栈帧切换来产生结果。

局部变量表：

随着栈帧的创建而创建，它的大小在编译时确定

存放8大基本数据类型、对象引用、returnAddress类型

#### 本机方法栈(运行Native方法空间)

与Java虚拟机栈实现的功能类似，区别在于本地方法栈是描述本地方法运行过程的内存模型。

Sun HotSpot直接就把本地方法栈和虚拟机栈合二为一。

#### 堆(存放对象的内存空间)

在虚拟机启动时创建，是垃圾回收的主要场所。

可分为：新生代、老年代、永久代(Java8移除)。

#### 元数据区(方法区在其中)

存储已被虚拟机加载的类信息、常量、静态变量、即时编译器编译后的代码等数据，其中常量就存放在运行时常量池中

Java7后字符串常量池被移到了堆中

#### 直接内存（堆外内存）

直接内存是除Java虚拟机之外的内存，但也可能被Java使用。